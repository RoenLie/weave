<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>esplot-viewer</title>
	<style>
	body {
		overflow: hidden;
		contain: strict;
		display: grid;
		height: 100vh;
		place-content: center;
		margin: 0px;
		padding: 0px;
	}
	iframe {
		all: unset;
		width: 100vw;
		height: 100vh;
	}
	</style>

	<script type="module">
		const setInnerHTML = (elm, html) => {
			elm.innerHTML = html;

			[...elm.querySelectorAll("script")].forEach( oldScriptEl => {
				const newScriptEl = document.createElement("script");

				[...oldScriptEl.attributes].forEach( attr => {
					newScriptEl.setAttribute(attr.name, attr.value)
				});

				const scriptText = document.createTextNode(oldScriptEl.innerHTML);
				newScriptEl.appendChild(scriptText);

				oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
			});
		}

		const conn = new WebSocket("ws://" + document.location.host + "/ws");
		conn.onclose = (evt) => {
			console.log('connection closed')
		};
		conn.onmessage = (evt) => {
			const html = evt.data
			const iframe = document.querySelector('iframe');

			setInnerHTML(iframe.contentWindow.document.documentElement, html);
		};
	</script>
</head>
<body>
<iframe></iframe>
</body>
</html>